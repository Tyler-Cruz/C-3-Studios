<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Signature Complexity Analyzer</title>
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <header>
      <div class="header-container">
        <img
          src="../images/CStudiosLogo.png"
          alt="C Studios Logo"
          class="logo"
        />
        <div>
          <h1>Signature Complexity Analyzer</h1>
        </div>
      </div>
    </header>

    <main class="main-layout">
      <!-- Upload Section -->
      <section class="upload-section">
        <input type="file" id="signatureInput" accept="image/png, image/jpeg" />
        <label for="signatureInput" class="upload-btn">Choose Signature</label>

        <div class="preview" id="previewBox">
          <p>Preview:</p>
          <img id="previewImage" alt="Signature Preview" />
        </div>

        <p class="error-message" id="errorMsg"></p>

        <div class="button-group">
          <button class="analyze-btn" id="analyzeBtn">Analyze</button>
          <button class="clear-btn" id="clearBtn">Clear Results</button>
        </div>

        <!-- Progress label and bar -->
        <p id="progressLabel" class="progress-label"></p>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </section>

      <!-- Results Section -->
      <section class="results-panel">
        <h2>Analysis Results</h2>
        <p>Overall Complexity Score:</p>
        <p class="score" id="complexityScore">--</p>

        <div class="metrics">
          <div class="metric">
            <h3>Pen Lifts</h3>
            <p id="penLifts">--</p>
          </div>
          <div class="metric">
            <h3>Pen Reversals</h3>
            <p id="penReversals">--</p>
          </div>
          <div class="metric">
            <h3>Pen Intersections</h3>
            <p id="penIntersections">--</p>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p>&copy; C<sup>3</sup> Studios</p>
    </footer>

    <script>
      const analyzeBtn = document.getElementById("analyzeBtn");
      const clearBtn = document.getElementById("clearBtn");
      const input = document.getElementById("signatureInput");
      const previewBox = document.getElementById("previewBox");
      const previewImage = document.getElementById("previewImage");
      const errorMsg = document.getElementById("errorMsg");

      // Initially disable buttons
      analyzeBtn.disabled = true;
      clearBtn.disabled = true;

      // Enable Analyze button only when a valid file is selected
      input.addEventListener("change", function () {
        errorMsg.textContent = "";
        const file = this.files[0];

        if (file && ["image/png", "image/jpeg"].includes(file.type)) {
          const reader = new FileReader();
          reader.onload = function (e) {
            previewImage.src = e.target.result;
            previewBox.style.display = "block";
          };
          reader.readAsDataURL(file);

          analyzeBtn.disabled = false; // Enable analyze
        } else {
          previewBox.style.display = "none";
          errorMsg.textContent =
            "Invalid file type. Please upload a PNG or JPEG image.";
          analyzeBtn.disabled = true; // Disable analyze
        }
      });

      // Simulate progress bar and analysis
      function simulateProgress() {
        const bar = document.getElementById("progressBar");
        const label = document.getElementById("progressLabel");

        analyzeBtn.disabled = true; // disable during analysis
        bar.classList.remove("complete");
        label.classList.remove("complete");
        label.textContent = "Analyzing...";
        bar.style.width = "0%";

        let width = 0;
        const interval = setInterval(() => {
          if (width >= 100) {
            clearInterval(interval);
            bar.classList.add("complete");
            label.textContent = "Complete!";
            label.classList.add("complete");

            analyzeBtn.disabled = false; // re-enable analyze
            clearBtn.disabled = false; // enable clear
          } else {
            width += 5;
            bar.style.width = width + "%";
          }
        }, 100);
      }

      // Analyze button click
      analyzeBtn.addEventListener("click", (e) => {
        e.preventDefault();
        if (!input.files.length) {
          errorMsg.textContent = "Please select a file before analyzing.";
          return;
        }

        errorMsg.textContent = "";
        simulateProgress();

        // Fill in results after progress completes
        setTimeout(() => {
          document.getElementById("complexityScore").textContent = "78.5";
          document.getElementById("penLifts").textContent = "3";
          document.getElementById("penReversals").textContent = "12";
          document.getElementById("penIntersections").textContent = "5";
        }, 2200);
      });

      // Clear button click
      clearBtn.addEventListener("click", function () {
        input.value = "";
        previewBox.style.display = "none";
        errorMsg.textContent = "";

        // Reset progress bar
        const progressBar = document.getElementById("progressBar");
        progressBar.style.width = "0%";
        progressBar.classList.remove("complete");

        // Reset progress label
        const progressLabel = document.getElementById("progressLabel");
        progressLabel.textContent = "";
        progressLabel.classList.remove("complete");

        // Clear results
        document.getElementById("complexityScore").textContent = "--";
        document.getElementById("penLifts").textContent = "--";
        document.getElementById("penReversals").textContent = "--";
        document.getElementById("penIntersections").textContent = "--";

        // Disable buttons until new file
        analyzeBtn.disabled = true;
        clearBtn.disabled = true;
      });
    </script>
  </body>
</html>
